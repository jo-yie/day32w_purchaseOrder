<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Order</title>
</head>
<body>

    <div class="container">

        <div class="shopping-cart">
            <img src="/shopping-cart.jpg" width="200px">
        </div>

        <div class="forms">

        <form [formGroup]="form" (submit)="processForm()">

            <div class="form-group">

            <div class="row">

            <!-- <ul>
                <li>Form valid: {{ form.valid }}</li>
                <li>Form invalid: {{ form.invalid }}</li>
            </ul> -->
        
            <div class="col card">

                <h3>Purchase Order</h3>
        
                <table>
                    <tr>
                        <td>Name</td>
                        <td>
                            <input type="text"
                                formControlName="name"
                                [ngClass]="{
                                    'valid': isCtrlValid('name'),
                                    'invalid': isCtrlInvalid('name')
                                }" 
                                class="form-control"
                                >
                        </td>
                    </tr>
                    <tr>
                        <td>Address</td>
                        <td>
                            <input type="text"
                                formControlName="address"
                                [ngClass]="{
                                    'valid': isCtrlValid('address'),
                                    'invalid': isCtrlInvalid('address')
                                }"
                                class="form-control"
                                >
                        </td>
                    </tr>
                    <tr>
                        <td>Email</td>
                        <td>
                            <input type="email"
                                formControlName="email"
                                [ngClass]="{
                                    'valid': isCtrlValid('email'),
                                    'invalid': isCtrlInvalid('email')
                                }"
                                class="form-control"
                                >
                        </td>
                    </tr>
                    <tr>
                        <td>Delivery Date</td>
                        <td>
                            <input type="date"
                                formControlName="deliveryDate"
                                [ngClass]="{
                                    'valid': isCtrlValid('deliveryDate'),
                                    'invalid': isCtrlInvalid('deliveryDate')
                                }"
                                class="form-control"
                                >
                        </td>
                    </tr>
                    <tr>
                        <td>Availability</td>
                        <td>
                            <select formControlName="availability" class="form-select">
                                <option value="0">0900 - 1200</option>
                                <option value="1">1200 - 1600</option>
                                <option value="2">1600 - 2000</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Urgent</td>
                        <td>
                            <input type="checkbox"
                                formControlName="urgent"
                                class="form-check"
                                >
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <button type="submit"
                                [disabled]="invalid()"
                                class="btn btn-primary">
                                Submit Order
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <button
                            (click)="addLineItem()"
                            class="btn btn-primary">
                            Add Line Item
                        </button>
                    </tr>
                </table>
        
            </div>
        
        
        
            <div class="col card">
        
                @if (lineItems.controls.length > 0) {
        
                    <h3>Line Items</h3>
            
                    <table>
                        <thead>
                            <tr>
                                <th>Item Name</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                            </tr>
                        </thead>
                        <tbody formArrayName="lineItems">
                
                            @for (li of lineItems.controls; let idx = $index; track li) {
                                <tr [formGroupName]="idx">
                                    <td>
                                        <input type="text"
                                            formControlName="itemName"
                                            [ngClass]="{
                                                'valid': isLineItemValid(idx, 'itemName'),
                                                'invalid': isLineItemInvalid(idx, 'itemName')
                                            }"
                                            class="form-control"
                                            >
                                    </td>
                                    <td>
                                        <input type="number"
                                            formControlName="quantity"
                                            min="0"
                                            class="form-control">
                                    </td>
                                    <td>
                                        <input type="number"
                                            formControlName="unitPrice"
                                            min="0"
                                            step="0.01"
                                            class="form-control">
                                    </td>
                                    <td>
                                        <button (click)="removeLineItem(idx)"
                                            class="btn btn-danger">
                                            X
                                        </button>
                                    </td>
                                </tr>
                            }
                
                        </tbody>
                    </table>
            
                } @else {
                        <h3>No Line Items Added</h3>
                }
        
            </div>

            </div>

            </div>
        
        </form>

        </div>

    </div>
    
</body>
</html>